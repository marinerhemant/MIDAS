# TOMO/ — Tomographic Reconstruction

This directory contains the absorption-contrast CT reconstruction engine based on the **gridrec** algorithm — a Fourier-domain filtered back-projection method using prolate spheroidal wave function (PSWF) interpolation.

---

## Directory Structure

```
TOMO/
├── src/                    # C source code
├── bin/                    # Compiled binary (generated by build)
├── process_hdf.py          # Python entry point for APS HDF5 data
├── midas_tomo_python.py    # Python entry point for programmatic use
└── CMakeLists.txt          # Build configuration
```

---

## What It Does

MIDAS TOMO reconstructs absorption-contrast cross-sections from rotation-series projection images. It is designed for synchrotron tomography data but works with any classical CT geometry.

**Key capabilities:**

- **Dark-field and white-field normalization** — automatic correction using dark and white (flat-field) reference frames.
- **Multiple reconstruction filters** — Shepp-Logan, Hann (default), Hamming, and Ramp.
- **Rotation-axis shift search** — reconstructs at multiple candidate center positions to find optimal alignment.
- **Ring artifact removal** — sinogram-space filtering to suppress ring artifacts from detector pixel defects.
- **OpenMP parallelism** — multi-threaded slice reconstruction.

---

## Entry Points

| Script | Input | Use Case |
|--------|-------|----------|
| `process_hdf.py` | HDF5 file with `/exchange/data` layout | Standard APS data exchange format. Auto-discovers dark/white frames. |
| `midas_tomo_python.py` | NumPy arrays (dark, whites, projections) | Programmatic / Jupyter / custom data formats. |

Both generate a parameter file and call the `MIDAS_TOMO` C binary.

### Usage

```bash
# From an APS HDF5 file:
python process_hdf.py -fn data.h5 -nCPUs 10

# Programmatic (in Python):
from midas_tomo_python import reconstruct
reconstruct(dark_frame, white_frames, projections, angles, output_dir)
```

---

## Source Code (`src/`)

| Source | Description |
|--------|-------------|
| `tomo_heads.h` | Header file with type definitions, constants, and function declarations. |
| `tomo_init.c` | Parameter parsing, memory allocation, sinogram construction, and normalization. |
| `tomo_gridrec.c` | **Core reconstruction engine.** Implements the gridrec algorithm with PSWF interpolation and FFTW-based filtering. |
| `tomo_utils.c` | Utility functions: ring removal, centering, image I/O, filter generation. |
| `tomo_cleanup.c` | Memory cleanup and resource deallocation. |

The output is a set of reconstructed slices stored as `float32` binary files, with dimensions rounded up to the next power of 2.

---

## See Also

- [Tomography_Reconstruction manual](../manuals/Tomography_Reconstruction.md) — complete user guide with parameter reference, data formats, rotation-center alignment, and troubleshooting.
